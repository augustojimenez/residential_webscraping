---
title: "EDA: Housing Bella Vista, Santo Domingo"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r importing-data}
rm(list = ls())

library(ggplot2)
library(dplyr)
library(stargazer)
```

```{r}
housing <- readRDS("../data/housing_140721(2).rds") %>%
    select(parking:bedrooms, neighborhood:status, usage:gimnasio, everything()) %>%
    mutate(across(parking:gimnasio, as.factor)) %>%
    filter(area <= 350)
```



```{r}
set.seed(123)

`%nin%` <- Negate(`%in%`)

housing <- housing %>%
    mutate(l.price = log(price.usd),
           area2 = area^2,
           area.bedroom = area / as.numeric(bedrooms))

train <- sample(1:nrow(housing),
                 round(nrow(housing)) * 0.7)
test <- 1:nrow(housing) %nin% train

housing.train <- housing[train, ]
housing.test <- housing[test, ]
```

```{r}
housing.train %>%
    ggplot(aes(y = price.usd, x = area2)) +
    geom_point() +
    geom_smooth()

housing.train %>%
    ggplot(aes(y = price.usd, x = area, fill = gimnasio)) +
    geom_point() +
    geom_smooth()

housing.train %>%
    ggplot(aes(y = l.price, fill = lift)) +
    geom_boxplot()

housing.train %>%
    ggplot(aes(y = l.price, fill = pool)) +
    geom_boxplot()

housing.train %>%
    ggplot(aes(y = l.price, fill = gimnasio)) +
    geom_boxplot()
```

```{r}
# Model 1
lm.fit1 = lm(formula = price.usd ~ area,
             data = housing.train)
summary(lm.fit1)

# Model 2
lm.fit2 = lm(formula = log(price.usd) ~ area + parking + area*bathrooms + pool + gimnasio + balcon*area + 0,
             data = housing.train)

# Model 3
lm.fit3 = lm(formula = log(price.usd) ~ area + parking + pool + gimnasio + balcon*area + 0,
             data = housing.train)

# Model 4
lm.fit4 = lm(formula = log(price.usd) ~ area + area2 + area*parking + area.bedroom + pool + gimnasio + balcon*area + 0,
             data = housing.train)

# Model 4
lm.fit5 = lm(formula = log(price.usd) ~ area + area2 + area*parking + area.bedroom + pool + gimnasio + balcon*area + 0,
             data = housing.train)

stargazer(lm.fit1, lm.fit2, lm.fit3, lm.fit4, type = "text")

# Random fit https://www.supercasas.com/apartamentos-venta-bella-vista-norte/1249620/
nuevo <- data.frame(area = 138,
                    parking = as.factor(2), 
                    bedrooms = as.factor(2), 
                    bathrooms = as.factor(2.5), 
                    pool = as.factor(TRUE), 
                    gimnasio = as.factor(TRUE), 
                    balcon = as.factor(TRUE))
exp(predict(lm.fit2, nuevo, interval = "prediction"))
# Actual price = 185,000
```